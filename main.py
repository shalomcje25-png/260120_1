import streamlit as st

# ë°ì´í„° ì •ì˜
enneagram_data = {
    "1": "ê°œí˜ê°€", "2": "ì¡°ë ¥ì", "3": "ì„±ì·¨ì", "4": "ì˜ˆìˆ ê°€", 
    "5": "íƒêµ¬ì", "6": "ì¶©ì‹¤ê°€", "7": "ì—´ì •ê°€", "8": "ë„ì „ì", "9": "í‰í™”ì£¼ì˜ì"
}

# í•˜ìœ„ìœ í˜• í…ŒìŠ¤íŠ¸ ì§ˆë¬¸
subtype_questions = {
    "ìê¸°ë³´ì¡´(SP)": [
        "ë‚˜ëŠ” ê±´ê°•, ì‹ì‚¬, ìˆ˜ë©´ ë“± ì‹ ì²´ì  ì•ˆë½í•¨ì„ ì±™ê¸°ëŠ” ê²ƒì´ ê°€ì¥ ì¤‘ìš”í•˜ë‹¤.",
        "ê²½ì œì  ì•ˆì •ì´ë‚˜ ì£¼ê±° í™˜ê²½ì˜ ì¾Œì í•¨ì— ë¯¼ê°í•˜ê²Œ ë°˜ì‘í•œë‹¤."
    ],
    "ì„±ì (SX)": [
        "ë‚˜ëŠ” ì‚¬ëŒì´ë‚˜ ì¼ì— ëŒ€í•´ ê°•ë ¬í•œ ì—´ì •ê³¼ ì—ë„ˆì§€ë¥¼ ëŠë¼ëŠ” ê²ƒì´ ì¤‘ìš”í•˜ë‹¤.",
        "ì¼ëŒ€ì¼ë¡œ ê¹Šê³  ì¡°ë°€í•˜ê²Œ ì—°ê²°ë˜ëŠ” ê´€ê³„ë¥¼ ì„ í˜¸í•œë‹¤."
    ],
    "ì‚¬íšŒì (SO)": [
        "ë‚˜ëŠ” ì§‘ë‹¨ ë‚´ì—ì„œ ë‚˜ì˜ ì—­í• ì´ë‚˜ ì†Œì†ê°ì„ í™•ì¸í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•˜ë‹¤.",
        "ì‚¬íšŒì˜ íë¦„ì´ë‚˜ ëª¨ì„ì˜ ë¶„ìœ„ê¸°ë¥¼ íŒŒì•…í•˜ëŠ” ë° ì—ë„ˆì§€ë¥¼ ë§ì´ ì“´ë‹¤."
    ]
}

def run_subtype_test(prefix):
    st.markdown(f"#### ğŸ“ {prefix} í•˜ìœ„ìœ í˜• í…ŒìŠ¤íŠ¸")
    st.caption("ê°€ì¥ ê³µê°ë˜ëŠ” í•­ëª©ì„ ì„ íƒí•˜ì„¸ìš”.")
    scores = {}
    for subtype, questions in subtype_questions.items():
        count = 0
        for q in questions:
            if st.checkbox(f"{q}", key=f"{prefix}_{q}"):
                count += 1
        scores[subtype] = count
    
    # ê°€ì¥ ë†’ì€ ì ìˆ˜ì˜ í•˜ìœ„ìœ í˜• ë°˜í™˜
    return max(scores, key=scores.get) if any(scores.values()) else "ë¯¸ì •"

# UI ì„¤ì •
st.set_page_config(page_title="ì—ë‹ˆì–´ê·¸ë¨ íŒŒíŠ¸ë„ˆì‹­ ê°€ì´ë“œ", layout="wide")
st.title("ğŸ§© ì—ë‹ˆì–´ê·¸ë¨ ê´€ê³„ ë¶„ì„ & í•˜ìœ„ìœ í˜• í…ŒìŠ¤íŠ¸")

# ë©”ì¸ í™”ë©´ - ë‘ ê°œì˜ ì—´ë¡œ ë‚˜ëˆ”
col1, col2 = st.columns(2)

with col1:
    st.header("ë‚˜ (User)")
    my_gender = st.radio("ì„±ë³„", ["ì—¬ì„±", "ë‚¨ì„±"], key="my_gender", horizontal=True)
    my_type = st.selectbox("ì—ë‹ˆì–´ê·¸ë¨ ìœ í˜•", list(enneagram_data.keys()), 
                           format_func=lambda x: f"{x}ë²ˆ: {enneagram_data[x]}", index=4)
    my_detected_subtype = run_subtype_test("ë‚˜ì˜")

with col2:
    st.header("ìƒëŒ€ë°© (Partner)")
    p_gender = st.radio("ì„±ë³„", ["ì—¬ì„±", "ë‚¨ì„±"], key="p_gender", horizontal=True, index=1)
    p_type = st.selectbox("ìƒëŒ€ë°© ìœ í˜•", list(enneagram_data.keys()), 
                         format_func=lambda x: f"{x}ë²ˆ: {enneagram_data[x]}", index=8)
    p_detected_subtype = run_subtype_test("ìƒëŒ€ë°©ì˜")

st.divider()

# ê²°ê³¼ ë¶„ì„ ì„¹ì…˜
if st.button("ğŸš€ ì¢…í•© ê´€ê³„ ë¶„ì„ ê²°ê³¼ ë³´ê¸°"):
    if my_detected_subtype == "ë¯¸ì •" or p_detected_subtype == "ë¯¸ì •":
        st.warning("í…ŒìŠ¤íŠ¸ í•­ëª©ì„ í•˜ë‚˜ ì´ìƒ ì„ íƒí•´ì•¼ ì •í™•í•œ í•˜ìœ„ìœ í˜• ë¶„ì„ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.")
    else:
        st.success(f"### ë¶„ì„ ê²°ê³¼: {my_type}ë²ˆ {my_gender}({my_detected_subtype}) & {p_type}ë²ˆ {p_gender}({p_detected_subtype})")
        
        # ì„±ë³„ ë° ìœ í˜• ì¡°í•© íŠ¹í™” ì¡°ì–¸
        if my_type == "5" and p_type == "9" and my_gender == "ì—¬ì„±" and p_gender == "ë‚¨ì„±":
            st.markdown("""
            #### ğŸ’¡ 5ë²ˆ ì•„ë‚´ & 9ë²ˆ ë‚¨í¸ì„ ìœ„í•œ íŠ¹ë³„ ì¡°ì–¸
            * **ê³µê°„ì˜ ì˜ë¯¸:** ë‚¨í¸ë¶„ì—ê²Œ 'ì§‘ê¾¸ë¯¸ê¸°'ëŠ” ì‹¬ë¦¬ì  í‰í™”ë¥¼ ìœ ì§€í•˜ëŠ” í•„ìˆ˜ í™œë™ì…ë‹ˆë‹¤. ì•„ë‚´ë¶„ì€ ì´ë¥¼ 'ìì› ë‚­ë¹„'ê°€ ì•„ë‹Œ 'ì•ˆì „ê¸°ì§€ êµ¬ì¶•'ìœ¼ë¡œ ë´ì£¼ì„¸ìš”.
            * **ì—ë„ˆì§€ ê´€ë¦¬:** ì•„ë‚´ë¶„ì´ "ì¼ë‹¨ ë¨¹ì"ê³  í•  ë•ŒëŠ” ì§€ì ìœ¼ë¡œ ê³ ê°ˆëœ ìƒíƒœì¼ í™•ë¥ ì´ ë†’ìŠµë‹ˆë‹¤. ë‚¨í¸ë¶„ì€ ì´ë•Œ ì„œìš´í•´í•˜ì§€ ë§ê³  í•¨ê»˜ ë§›ìˆëŠ” ìŒì‹ì„ ì¦ê¸°ë©° ì¹¨ë¬µì˜ íœ´ì‹ì„ ì„ ë¬¼í•˜ì„¸ìš”.
            """)
        
        # í•˜ìœ„ìœ í˜• ì¡°í•© ë¶„ì„
        st.subheader("ğŸ“Œ ë³¸ëŠ¥ì  ì¡°í•© ë¶„ì„")
        if my_detected_subtype == "ìê¸°ë³´ì¡´(SP)" and p_detected_subtype == "ìê¸°ë³´ì¡´(SP)":
            st.write("ë‘ ë¶„ ëª¨ë‘ **ìê¸°ë³´ì¡´(SP)** ë³¸ëŠ¥ì´ ìš°ì„¸í•©ë‹ˆë‹¤. ì´ëŠ” ìƒí™œ ìŠµê´€ì´ ë¹„ìŠ·í•´ í° ê°ˆë“±ì€ ì—†ì§€ë§Œ, ë‘˜ ë‹¤ 'ìì‹ ì˜ ì˜ì—­'ì— ì˜ˆë¯¼í•  ìˆ˜ ìˆìŒì„ ëœ»í•©ë‹ˆë‹¤.")
            st.write("- **ì†”ë£¨ì…˜:** ê°ìì˜ 'ë™êµ´'ì„ ì¸ì •í•˜ë˜, í•¨ê»˜í•˜ëŠ” ì‹ì‚¬ ì‹œê°„ì„ 'ê³µì‹ì ì¸ ì—°ê²° ì‹œê°„'ìœ¼ë¡œ í™œìš©í•˜ì„¸ìš”.")
        else:
            st.write(f"ë‚˜ì˜ {my_detected_subtype} ë³¸ëŠ¥ê³¼ ìƒëŒ€ë°©ì˜ {p_detected_subtype} ë³¸ëŠ¥ì´ ë§Œë‚˜ ì„œë¡œì˜ ë¶€ì¡±í•œ ë¶€ë¶„ì„ ë³´ì™„í•˜ê±°ë‚˜ ë°°ìš¸ ìˆ˜ ìˆëŠ” ì¡°í•©ì…ë‹ˆë‹¤.")

        # ì—ë‹ˆì–´ê·¸ë¨ í†µí•© ë§¤íŠ¸ë¦­ìŠ¤ ì´ë¯¸ì§€ ì°¸ê³ 
        st.info("ì—ë‹ˆì–´ê·¸ë¨ì€ ì„œë¡œì˜ 'ì•ˆê²½'ì´ ë‹¤ë¦„ì„ ì´í•´í•˜ëŠ” ë„êµ¬ì…ë‹ˆë‹¤.")
